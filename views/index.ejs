<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title> Task Manager</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/allTodoListsstyle.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  </head>

  <body>
    
    <div class="app-container">
      <header>
        <h1>My Daily Tasks</h1>
      </header>

      <form action="/add-todo" method="POST" class="add-form">
        <input
          type="text"
          name="title"
          placeholder="Add a new masterpiece..."
          required
        />
        <button type="submit">Add</button>
      </form>

      <ul class="todo-list">
        <% todos.forEach(todo => { %>
        <li class="<%= todo.completed ? 'is-completed' : '' %>">
          <div class="todo-content">
            <span class="text"><%= todo.title %></span>
          </div>

          <div class="todo-actions">
            <a
              href="/toggle-todo/<%= todo.id %>"
              title="Toggle Status"
              class="status-icon"
            >
              <% if (todo.completed) { %>
              <i class="bi bi-arrow-counterclockwise text-secondary"></i>
              <% } else { %>
              <i class="bi bi-check-circle-fill text-success"></i>
              <% } %>
            </a>

            <button
              onclick="editTodo('<%= todo.id %>', '<%= todo.title %>')"
              class="btn-edit"
              title="Edit"
            >
              <i class="bi bi-pencil-square text-primary"></i>
            </button>

            <a
              href="/delete-todo/<%= todo.id %>"
              class="btn-delete"
              title="Delete"
              onclick="return confirm('Are you sure?');"
            >
              <i class="bi bi-trash3 text-danger"></i>
            </a>
          </div>
        </li>
        <% }) %>
      </ul>

      <% if (todos.length === 0) { %>
      <div class="empty-state">
        <p>Your list is clear. Time to chill! â˜•</p>
      </div>
      <% } %>
    </div>

    <script>
      function editTodo(id, oldTitle) {
        const newTitle = prompt("Update your task:", oldTitle);
        if (newTitle && newTitle.trim() !== "" && newTitle !== oldTitle) {
          const form = document.createElement("form");
          form.method = "POST";
          form.action = `/edit-todo/${id}`;

          const input = document.createElement("input");
          input.type = "hidden";
          input.name = "title";
          input.value = newTitle;

          form.appendChild(input);
          document.body.appendChild(form);
          form.submit();
        }
      }
    </script>
  </body>
</html>
